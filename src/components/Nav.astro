---
import Logo from '@v1/assets/images/milo-logo.svg';
import Arrow from '@v1/assets/icons/arrow.svg';
import navigation from '@data/navigation.json';
import Icon from '@components/Icon.astro';
import MobileMenu from '@components/MobileMenu.astro';
import GithubStargazerValue from '@components/GithubStargazerValue.astro';
import Button from '@components/Button.astro';

import type { NavData } from '@/src/types/navigation';

// Type-safe navigation data
const navData = navigation as NavData;
const mainNav = navData.main;
---

<nav class="nav--main">
  {/* Logo */}
  <div class="nav-logo-container">
    <a href="/" class="nav-logo" id="logo-link" aria-label="Milo Logo" title="Milo Logo">
      <Logo
        class="fade-in--pure"
        data-reveal="fade-in--pure--visible"
        data-reveal-delay="100"
        data-reveal-immediate="true"
      />
    </a>
  </div>

  {/* Desktop Menu */}
  <ul
    class="nav-menu fade-in--pure"
    data-reveal="fade-in--pure--visible"
    data-reveal-delay="100"
    data-reveal-immediate="true"
  >
    {
      mainNav.map((item) => (
        <li class={`nav-menu-item ${item.children ? 'nav-dropdown' : ''}`}>
          <a href={item.href} class="nav-menu-link" data-astro-prefetch="hover">
            <span>{item.text}</span>
            {item.children && <Arrow class="nav-dropdown-arrow" />}
          </a>
          {item.children && (
            <ul class={`nav-dropdown-menu ${item.children.length > 1 ? 'nav-dropdown-mega' : ''}`}>
              {item.children.map((section) => (
                <li
                  class={`nav-dropdown-section ${item.children!.length > 1 ? 'nav-dropdown-mega-section' : ''}`}
                >
                  {'title' in section && section.title && (
                    <h3 class="nav-dropdown-title">{section.title}</h3>
                  )}
                  <ul
                    class={`nav-dropdown-items ${item.children!.length > 1 ? 'nav-dropdown-mega-items' : ''}`}
                  >
                    {section.items?.map((subItem) => (
                      <li class="nav-dropdown-item">
                        <a
                          href={subItem.href}
                          class="nav-dropdown-link"
                          data-astro-prefetch="hover"
                        >
                          {'icon' in subItem && subItem.icon && (
                            <div class="nav-dropdown-icon">
                              <Icon name={subItem.icon} size="md" />
                            </div>
                          )}
                          <span>{subItem.text}</span>
                        </a>
                      </li>
                    ))}
                  </ul>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))
    }
  </ul>

  {/* Desktop Actions */}
  <div class="nav-actions">
    <Button
      class="btn btn--primary gh-button fade-in--pure min-w-[115px]"
      data-reveal="fade-in--pure--visible"
      data-reveal-delay="100"
      data-reveal-immediate="true"
      icon={{ name: 'github', size: 'md' }}
      iconPosition="left"
      iconClass="stroke-1.5"
      target="_blank"
      href="https://github.com/datum-cloud/milo/"
    >
      <GithubStargazerValue server:defer />
    </Button>
  </div>

  {/* Mobile Menu Component */}
  <MobileMenu navigation={mainNav} />
</nav>
