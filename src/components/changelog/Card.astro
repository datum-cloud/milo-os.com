---
import Bullet from '@v1/assets/icons/bullet.svg';
import { changelogs, type ChangelogProps } from '@/src/libs/milo';
import { processCalloutMarkdown } from '@/src/utils/calloutUtils';

const changelogsEntries = await changelogs();
const { limit } = Astro.props;
const entries = limit ? changelogsEntries.slice(0, limit) : changelogsEntries;
---

{
  entries.length > 0 ? (
    entries.map((entry: ChangelogProps) => async () => (
      <li class="display-card--item">
        <div class="display-card--item-meta item-neta--timeline">
          <Bullet class={limit ? 'text-aurora-moss' : 'text-canyon-clay'} />
        </div>
        <div
          class={
            limit
              ? 'display-card--item-content text-white [&_*]:text-white'
              : 'display-card--item-content'
          }
        >
          <h4>{entry.title}</h4>
          <div set:html={await processCalloutMarkdown(entry.body)} />
        </div>
      </li>
    ))
  ) : (
    <li class="text-center text-muted-foreground">No changelog entries found.</li>
  )
}
